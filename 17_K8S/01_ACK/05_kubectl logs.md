`kubectl logs` æ˜¯ Kubernetes ä¸­ç”¨äºæŸ¥çœ‹ Pod ä¸­å®¹å™¨æ—¥å¿—çš„æ ¸å¿ƒå‘½ä»¤ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ æ’æŸ¥åº”ç”¨é—®é¢˜ã€ç›‘æ§è¿è¡ŒçŠ¶æ€ã€åˆ†æé”™è¯¯ä¿¡æ¯ã€‚

------

## ğŸ“Œ ä¸€ã€åŸºæœ¬è¯­æ³•

```bash
kubectl logs [POD_NAME] [OPTIONS]
```

å¦‚æœ Pod ä¸­æœ‰å¤šä¸ªå®¹å™¨ï¼Œéœ€è¦æŒ‡å®šå®¹å™¨åã€‚

------

## ğŸš€ äºŒã€å¸¸ç”¨å‘½ä»¤ä¸ç”¨æ³•

### 1. æŸ¥çœ‹æŸä¸ª Pod çš„æ—¥å¿—ï¼ˆå•å®¹å™¨ï¼‰

```bash
kubectl logs my-pod
```

> å‡è®¾ `my-pod` åªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚

------

### 2. æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ—¥å¿—ï¼ˆå¤šå®¹å™¨ Podï¼‰

```bash
kubectl logs my-pod -c container-name
```

- `-c` æˆ– `--container`ï¼šæŒ‡å®šå®¹å™¨åç§°ã€‚
- é€‚ç”¨äºä¸€ä¸ª Pod ä¸­æœ‰å¤šä¸ªå®¹å™¨ï¼ˆå¦‚ä¸»åº”ç”¨ + sidecarï¼‰ã€‚

------

### 3. å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆç±»ä¼¼ `tail -f`ï¼‰

```bash
kubectl logs -f my-pod
```

- `-f` æˆ– `--follow`ï¼šæŒç»­è¾“å‡ºæ–°æ—¥å¿—ï¼Œå®æ—¶è·Ÿè¸ªã€‚

> å¯ç»“åˆå®¹å™¨ä½¿ç”¨ï¼š`kubectl logs -f my-pod -c app-container`

------

### 4. æŸ¥çœ‹æœ€è¿‘ N è¡Œæ—¥å¿—

```bash
kubectl logs --tail=20 my-pod
```

- åªæ˜¾ç¤ºæœ€å 20 è¡Œæ—¥å¿—ã€‚
- é€‚ç”¨äºæ—¥å¿—å¤ªå¤šæ—¶å¿«é€ŸæŸ¥çœ‹æœ«å°¾å†…å®¹ã€‚

------

### 5. æŸ¥çœ‹è¿‡å»ä¸€æ®µæ—¶é—´å†…çš„æ—¥å¿—

```bash
kubectl logs --since=1h my-pod
```

- æŸ¥çœ‹è¿‡å» 1 å°æ—¶çš„æ—¥å¿—ã€‚
- æ”¯æŒå•ä½ï¼š`s`ï¼ˆç§’ï¼‰ã€`m`ï¼ˆåˆ†é’Ÿï¼‰ã€`h`ï¼ˆå°æ—¶ï¼‰

**ç¤ºä¾‹ï¼š**

```bash
kubectl logs --since=30m my-pod        # æœ€è¿‘30åˆ†é’Ÿ
kubectl logs --since=2h --tail=50 my-pod # 2å°æ—¶å†…ï¼Œæœ€å¤š50è¡Œ
```

------

### 6. æŒ‡å®šæ—¶é—´èŒƒå›´æŸ¥çœ‹æ—¥å¿—

```bash
kubectl logs --since-time="2025-01-01T00:00:00Z" my-pod
```

- ä½¿ç”¨ RFC3339 æ ¼å¼ã€‚
- æ³¨æ„æ—¶åŒºï¼šé€šå¸¸ç”¨ UTC æ—¶é—´ã€‚

------

### 7. æŸ¥çœ‹ä¹‹å‰å®¹å™¨çš„æ—¥å¿—ï¼ˆé‡å¯/å´©æºƒåï¼‰

```bash
kubectl logs my-pod --previous
```

- `-p` æˆ– `--previous`ï¼šæŸ¥çœ‹ä¸Šä¸€ä¸ªå®¹å™¨å®ä¾‹çš„æ—¥å¿—ã€‚
- å¯¹æ’æŸ¥å®¹å™¨å´©æºƒï¼ˆCrashLoopBackOffï¼‰éå¸¸æœ‰ç”¨ã€‚

> ä¾‹å¦‚ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œé‡å¯ååŸå®ä¾‹æ—¥å¿—å·²ä¸¢å¤±ï¼Œç”¨ `--previous` å¯æŸ¥çœ‹å¤±è´¥æ—¶çš„æ—¥å¿—ã€‚

------

### 8. æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´çš„ Pod æ—¥å¿—

```bash
kubectl logs -n namespace-name my-pod
```

- `-n` æˆ– `--namespace`ï¼šæŒ‡å®šå‘½åç©ºé—´ã€‚
- é»˜è®¤æ˜¯ `default` å‘½åç©ºé—´ã€‚

------

### 9. ç»“åˆæ ‡ç­¾ï¼ˆLabelï¼‰æŸ¥çœ‹æ—¥å¿—

```bash
kubectl logs -l app=nginx
```

- `-l` æˆ– `--selector`ï¼šæ ¹æ®æ ‡ç­¾é€‰æ‹© Podã€‚
- å¦‚æœåŒ¹é…å¤šä¸ª Podï¼Œä¼šä¾æ¬¡æ˜¾ç¤ºæ¯ä¸ª Pod çš„æ—¥å¿—ã€‚

**åªçœ‹å…¶ä¸­ä¸€ä¸ªï¼ˆé…åˆ `--max-log-requests`ï¼‰ï¼š**

```bash
kubectl logs -l app=nginx --max-log-requests=1
```

------

### 10. é™åˆ¶æ—¥å¿—è¾“å‡ºå¤§å°

```bash
kubectl logs my-pod --limit-bytes=1024
```

- é™åˆ¶è¾“å‡ºæ—¥å¿—å¤§å°ä¸º 1024 å­—èŠ‚ã€‚
- å¯ç”¨äºé¿å…ä¸€æ¬¡æ€§è¾“å‡ºè¿‡å¤šæ—¥å¿—ã€‚

------

### 11. æŸ¥çœ‹ Deployment/StatefulSet ç®¡ç†çš„ Pod æ—¥å¿—

```bash
kubectl logs deployment/my-deployment
```

```bash
kubectl logs statefulset/my-statefulset
```

- ç›´æ¥é€šè¿‡æ§åˆ¶å™¨åç§°æŸ¥çœ‹å…¶ç®¡ç†çš„ä»»æ„ä¸€ä¸ª Pod çš„æ—¥å¿—ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªï¼‰ã€‚
- ä¹Ÿå¯ç»“åˆ `-c`ã€`-f` ç­‰å‚æ•°ä½¿ç”¨ã€‚

> âš ï¸ æ³¨æ„ï¼šå¦‚æœ Deployment æœ‰å¤šä¸ª Podï¼Œåªæ˜¾ç¤ºå…¶ä¸­ä¸€ä¸ªçš„æ—¥å¿—ã€‚å¦‚éœ€æŸ¥çœ‹æ‰€æœ‰ï¼Œå¯ç”¨æ ‡ç­¾é€‰æ‹©ã€‚

------

## ğŸ›  ä¸‰ã€å®ç”¨æŠ€å·§

### âœ… æŸ¥çœ‹æœ€è¿‘é‡å¯çš„ Pod çš„é”™è¯¯æ—¥å¿—

```bash
kubectl get pods | grep my-app
kubectl logs my-app-xxxxx --previous
```

### âœ… å®æ—¶è·Ÿè¸ª Deployment çš„æ—¥å¿—

```bash
kubectl logs -f deployment/my-app -n prod
```

### âœ… æŸ¥çœ‹æ‰€æœ‰åŒ¹é…æ ‡ç­¾çš„ Pod çš„æ—¥å¿—ï¼ˆå¹¶è¡Œï¼‰

```bash
kubectl logs -l app=backend --all-containers=true
```

- `--all-containers=true`ï¼šå¦‚æœ Pod æœ‰å¤šä¸ªå®¹å™¨ï¼Œæ˜¾ç¤ºæ‰€æœ‰å®¹å™¨æ—¥å¿—ã€‚

------

## ğŸ“š å››ã€å¸¸è§é€‰é¡¹æ€»ç»“

| é€‰é¡¹                         | è¯´æ˜                      |
| ---------------------------- | ------------------------- |
| `-f`, `--follow`             | å®æ—¶è·Ÿè¸ªæ—¥å¿—              |
| `-p`, `--previous`           | æŸ¥çœ‹ä¸Šä¸€ä¸ªå®¹å™¨å®ä¾‹çš„æ—¥å¿—  |
| `--tail=N`                   | ä»…æ˜¾ç¤ºæœ€å N è¡Œ           |
| `--since=1h`                 | æ˜¾ç¤ºæœ€è¿‘1å°æ—¶å†…çš„æ—¥å¿—     |
| `--since-time=...`           | ä»æŒ‡å®šæ—¶é—´å¼€å§‹çš„æ—¥å¿—      |
| `-c`, `--container=NAME`     | æŒ‡å®šå®¹å™¨åç§°              |
| `-n`, `--namespace=NAME`     | æŒ‡å®šå‘½åç©ºé—´              |
| `-l`, `--selector=KEY=VALUE` | æ ¹æ®æ ‡ç­¾é€‰æ‹© Pod          |
| `--max-log-requests=N`       | æœ€å¤§å¹¶å‘è·å–æ—¥å¿—çš„ Pod æ•° |
| `--limit-bytes=N`            | é™åˆ¶æ—¥å¿—è¾“å‡ºå¤§å°ï¼ˆå­—èŠ‚ï¼‰  |
| `--all-containers=true`      | è¾“å‡º Pod ä¸­æ‰€æœ‰å®¹å™¨æ—¥å¿—   |

------

## âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹

1. **Pod å¿…é¡»å­˜åœ¨**ï¼šå¦‚æœ Pod å·²è¢«åˆ é™¤ï¼Œæ— æ³•æŸ¥çœ‹æ—¥å¿—ã€‚
2. **æ—¥å¿—å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸Š**ï¼šæ—¥å¿—æ¥è‡ª Kubelet ç®¡ç†çš„å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ Dockerã€containerdï¼‰ï¼ŒèŠ‚ç‚¹æ¸…ç†æˆ–æ—¥å¿—è½®è½¬åå¯èƒ½ä¸¢å¤±ã€‚
3. **ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æ—¥å¿—æ”¶é›†ç³»ç»Ÿ**ï¼š
   - å¦‚ï¼š**EFK**ï¼ˆElasticsearch + Fluentd + Kibanaï¼‰
   - æˆ– **é˜¿é‡Œäº‘ SLS**ï¼ˆæ—¥å¿—æœåŠ¡ï¼‰
   - å®ç°æ—¥å¿—æŒä¹…åŒ–ã€æ£€ç´¢ã€å‘Šè­¦ã€‚

------

## âœ… å…­ã€ç¤ºä¾‹ï¼šç»¼åˆä½¿ç”¨

```bash
# æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒä¸­è®¢å•æœåŠ¡çš„å®æ—¶æ—¥å¿—ï¼ˆæœ€è¿‘100è¡Œï¼‰
kubectl logs -f deployment/order-service --tail=100 -n production

# æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ä¸º app=api çš„ Pod çš„æœ€å10è¡Œæ—¥å¿—
kubectl logs -l app=api --tail=10 --max-log-requests=5

# æŸ¥çœ‹ sidecar å®¹å™¨çš„æ—¥å¿—ï¼ˆä¸Šä¸€ä¸ªå®ä¾‹ï¼‰
kubectl logs my-pod -c sidecar --previous
```

------

## âœ… æ€»ç»“

`kubectl logs` æ˜¯è°ƒè¯• Kubernetes åº”ç”¨æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ã€‚æŒæ¡å®ƒçš„å„ç§å‚æ•°ï¼Œèƒ½æå¤§æå‡æ’æŸ¥é—®é¢˜çš„æ•ˆç‡ã€‚

> ğŸ”” **æç¤º**ï¼šç»“åˆ `kubectl describe pod` å’Œ `kubectl get pods` ä¸€èµ·ä½¿ç”¨ï¼Œèƒ½æ›´å…¨é¢åœ°äº†è§£ Pod çŠ¶æ€ã€‚